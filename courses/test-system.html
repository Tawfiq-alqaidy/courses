<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… - Course Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .test-card { 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); 
            margin-bottom: 2rem;
        }
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px 15px 0 0;
        }
        .result-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
        }
        .test-btn {
            margin: 0.5rem;
            border-radius: 8px;
        }
        .success-indicator { color: #28a745; }
        .error-indicator { color: #dc3545; }
        .info-indicator { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="test-card">
            <div class="test-header text-center">
                <h1 class="mb-3">
                    <i class="bx bx-test-tube me-2"></i>
                    Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª
                </h1>
                <p class="mb-0">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù…</p>
            </div>
            
            <div class="p-4">
                <!-- System Status -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h4><i class="bx bx-info-circle me-2"></i>Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                        <div id="systemStatus" class="result-box">
                            Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…...
                        </div>
                    </div>
                </div>
                
                <!-- Test Buttons -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h4><i class="bx bx-play-circle me-2"></i>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                        <div class="d-flex flex-wrap">
                            <button class="btn btn-primary test-btn" onclick="runTest('dashboard')">
                                <i class="bx bx-dashboard me-1"></i>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                            </button>
                            <button class="btn btn-success test-btn" onclick="runTest('courses')">
                                <i class="bx bx-book me-1"></i>Ø§Ù„Ø¯ÙˆØ±Ø§Øª
                            </button>
                            <button class="btn btn-info test-btn" onclick="runTest('categories')">
                                <i class="bx bx-category me-1"></i>Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
                            </button>
                            <button class="btn btn-warning test-btn" onclick="runTest('applications')">
                                <i class="bx bx-file-blank me-1"></i>Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                            </button>
                            <button class="btn btn-secondary test-btn" onclick="testWaitingList()">
                                <i class="bx bx-time me-1"></i>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
                            </button>
                            <button class="btn btn-dark test-btn" onclick="testApplication()">
                                <i class="bx bx-send me-1"></i>ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Test Results -->
                <div class="row">
                    <div class="col-12">
                        <h4><i class="bx bx-list-ul me-2"></i>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h4>
                        <div id="testResults" class="result-box">
                            Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ø²Ø± Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="row mt-4">
                    <div class="col-12 text-center">
                        <button class="btn btn-outline-primary" onclick="clearResults()">
                            <i class="bx bx-trash me-1"></i>Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                        </button>
                        <button class="btn btn-outline-success" onclick="runAllTests()">
                            <i class="bx bx-play me-1"></i>ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                        </button>
                        <a href="demo-application-form.html" class="btn btn-primary">
                            <i class="bx bx-external-link me-1"></i>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…
                        </a>
                        <a href="demo-admin-dashboard.html" class="btn btn-secondary">
                            <i class="bx bx-cog me-1"></i>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let testCount = 0;
        
        // Check system status on load
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemStatus();
        });
        
        async function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            try {
                const response = await fetch('test-api.php?action=test');
                const data = await response.json();
                
                if (data.success) {
                    statusDiv.innerHTML = `
                        <div class="success-indicator">âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ</div>
                        <div class="mt-2">
                            <strong>Ø¥ØµØ¯Ø§Ø± PHP:</strong> ${data.data.php_version}<br>
                            <strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${data.data.timestamp}<br>
                            <strong>Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</strong> ${data.data.message}
                        </div>
                        <div class="mt-3">
                            <strong>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ÙˆÙ„ÙŠ:</strong>
                            <ul class="mt-2">
                                <li>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙˆØ±Ø© 1: <span class="info-indicator">${data.data.test_results.course_1_status}</span></li>
                                <li>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙˆØ±Ø© 2: <span class="info-indicator">${data.data.test_results.course_2_status}</span></li>
                                <li>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${data.data.test_results.statistics.total_applications} Ø·Ù„Ø¨ØŒ ${data.data.test_results.statistics.registered} Ù…Ø³Ø¬Ù„ØŒ ${data.data.test_results.statistics.waiting} ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</li>
                            </ul>
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `<div class="error-indicator">âŒ Ø®Ø·Ø£: ${data.message}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="error-indicator">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}</div>`;
            }
        }
        
        async function runTest(action) {
            const resultsDiv = document.getElementById('testResults');
            testCount++;
            
            addResult(`ğŸ§ª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± #${testCount}: ${getActionName(action)}`);
            addResult('â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...');
            
            try {
                const response = await fetch(`test-api.php?action=${action}`);
                const data = await response.json();
                
                if (data.success) {
                    addResult(`âœ… Ù†Ø¬Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${getActionName(action)}`);
                    addResult(`ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©: ${JSON.stringify(data.data, null, 2)}`);
                } else {
                    addResult(`âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${data.message}`);
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©: ${error.message}`);
            }
            
            addResult('â”€'.repeat(50));
        }
        
        async function testWaitingList() {
            addResult(`ğŸ§ª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± #${++testCount}: Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±`);
            
            try {
                // Test promotion from waiting list for course 2 (which is full)
                const response = await fetch('test-api.php?action=promote&course_id=2');
                const data = await response.json();
                
                if (data.success) {
                    addResult('âœ… ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±');
                    addResult(`ğŸ“ ${data.message}`);
                    if (data.data) {
                        addResult(`ğŸ‘¤ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø±Ù‚Ù‰: ${data.data.student_name}`);
                    }
                } else {
                    addResult(`âŒ Ø®Ø·Ø£: ${data.message}`);
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£: ${error.message}`);
            }
            
            addResult('â”€'.repeat(50));
        }
        
        async function testApplication() {
            addResult(`ğŸ§ª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± #${++testCount}: ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯`);
            
            const sampleApplication = {
                student: {
                    name: 'Ø·Ø§Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ',
                    email: 'test@example.com',
                    phone: '0551234567'
                },
                courses: [1, 3] // Laravel course and Marketing course
            };
            
            try {
                const response = await fetch('test-api.php?action=apply', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(sampleApplication)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    addResult('âœ… ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                    data.data.forEach(result => {
                        addResult(`ğŸ“‹ ${result.course_name}: ${result.status} (${result.student_code})`);
                        addResult(`   ${result.message}`);
                    });
                } else {
                    addResult(`âŒ ÙØ´Ù„ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨: ${data.message}`);
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£: ${error.message}`);
            }
            
            addResult('â”€'.repeat(50));
        }
        
        async function runAllTests() {
            addResult('ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª...\n');
            
            const tests = ['dashboard', 'courses', 'categories', 'applications'];
            
            for (const test of tests) {
                await runTest(test);
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay
            }
            
            await testWaitingList();
            await testApplication();
            
            addResult('ğŸ‰ ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª!');
        }
        
        function addResult(message) {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.innerHTML += `[${timestamp}] ${message}\n`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function clearResults() {
            document.getElementById('testResults').innerHTML = 'ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...\n';
            testCount = 0;
        }
        
        function getActionName(action) {
            const names = {
                'dashboard': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
                'courses': 'Ø§Ù„Ø¯ÙˆØ±Ø§Øª',
                'categories': 'Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª',
                'applications': 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª'
            };
            return names[action] || action;
        }
    </script>
</body>
</html>
